<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@300&family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background-color: #000;
      background-size: cover; background-position: center;
      font-family: 'Quicksand', sans-serif; color: #fdf5e6;
      display: flex; flex-direction: column; justify-content: flex-end; 
      transition: background 1s ease-in-out; 
    }

    .exit-link {
      position: fixed; top: 20px; left: 20px;
      color: rgba(255, 255, 255, 0.4); font-size: 0.7rem;
      text-decoration: none; font-family: 'Cinzel';
      cursor: pointer; z-index: 100; border: 1px solid rgba(255,255,255,0.2);
      padding: 5px 10px; border-radius: 4px; transition: 0.3s;
    }
    .exit-link:hover { color: #d4af37; border-color: #d4af37; background: rgba(0,0,0,0.5); }

    .game-container {
      width: 100%; background: rgba(0,0,0,0.75); 
      backdrop-filter: blur(12px); border-top: 2px solid #d4af37;
      padding: 30px; box-sizing: border-box; text-align: center;
      min-height: 35%; animation: fadeIn 1s;
    }

    #story-text { 
      font-family: 'Courier Prime', monospace; font-size: 1.2rem; 
      max-width: 900px; margin: 0 auto 20px auto; min-height: 3em;
    }

    #choices {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 15px; max-width: 800px; margin: 0 auto;
    }

    .choice-btn {
      flex: 1; min-width: 200px; background: rgba(212, 175, 55, 0.1);
      border: 1px solid #d4af37; color: #fdf5e6; padding: 12px;
      cursor: pointer; font-family: 'Cinzel'; border-radius: 5px; transition: 0.3s;
    }
    .choice-btn:hover { background: #d4af37; color: #000; box-shadow: 0 0 10px #d4af37; }

    #player-input {
      width: 60%; max-width: 400px; padding: 12px; background: rgba(255,255,255,0.1);
      border: 1px solid #d4af37; color: white; border-radius: 5px;
      margin-bottom: 20px; text-align: center; font-family: 'Courier Prime';
    }

    .inventory { margin-top: 25px; font-size: 0.8rem; color: #d4af37; font-style: italic; opacity: 0.8; letter-spacing: 1px; }
    .hidden { display: none !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body id="game-body">

<a class="exit-link" onclick="location.href='index.html'">[ Return to Sanctuary ]</a>

<div class="game-container">
  <div id="story-text">Loading reality...</div>
  
  <div id="input-area" class="hidden">
    <input type="text" id="player-input" placeholder="Type here..." autocomplete="off">
  </div>

  <div id="choices"></div>
  
  <div class="inventory" id="inv-display">Inventory: Empty</div>
</div>

<script>
  let playerPassword = "";
  let inventory = [];

  const scenes = {
    password_check: {
      text: "Before the fragment opens, you must choose a password. Choose wisely...",
      input: true,
      buttonText: "Set Password",
      onAction: () => {
        const input = document.getElementById('player-input').value;
        if(input.length < 1) return alert("You need a password!");
        playerPassword = input;
        addToInventory(`Password: ${playerPassword}`); 
        renderScene('password_warning');
      }
    },
    password_warning: {
      text: () => `"${playerPassword}"... interesting choice. Look at your inventory. You are now carrying your password. Do not lose it.`,
      choices: [
        { text: "I understand. Open the gate.", next: "pea_field" }
      ]
    },
    pea_field: {
      text: "The gate creaks open. You are standing in a field of giant, rolling peas. Each one is the size of a bean bag chair.",
      background: "https://i.pinimg.com/1200x/fd/e8/9b/fde89b5dee8a1005afbe1b65923d27ae.jpg",
      choices: [
        { text: "Approach a particularly large pea", next: "giant_pea" },
        { text: "Search for a snack in the pods", next: "pod_search" }
      ]
    },
    giant_pea: {
      text: "The pea rotates slowly. 'I once loved an Italian plant... Mentha peperita,' it whispers. 'She overwatered herself and died after her favorite book protagonist perished. Tell me... have you ever been in love?'",
      background: "https://i.pinimg.com/1200x/49/e8/7b/49e87be63ce926806a84c1529c1d5958.jpg",
      choices: [
        { text: "Play Adrianne Lenker's 'Anything'", next: "lenker_path" },
        { text: "Ragebait him with a Kid Yugi song", next: "yugi_path" }
      ]
    },
    lenker_path: {
      text: "The pea goes silent, mesmerized by the music. He unfurls a coily steeling and points silently toward a new field. He looks bittersweet as you walk away.",
      background: "https://i.pinimg.com/736x/c4/e9/3f/c4e93f27453842aa774a6c956200a01a.jpg",
      choices: [ { text: "Walk into the field...", next: "pea_field" } ]
    },
    yugi_path: {
      text: "You tell him it's a deep Italian song all chicks love. The beat drops—the pea turns purple and explodes! A giant chunk hits you in the chest. Everything goes black.",
      choices: [ { text: "Wake up...", next: "lake_party" } ]
    },
    lake_party: {
      text: "You wake up by a lake. Sea animals are having a massive party with tiny hats and even tinier drinks. The vibes are immaculate.",
      background: "https://i.pinimg.com/736x/82/c9/8f/82c98fb149d724563f02e90c3489c238.jpg",
      choices: [ { text: "Join the sea animal rave", next: "pea_field" } ]
    },
    pod_search: {
      text: "You climb into a massive, open pod. It’s surprisingly cozy. You fall into a deep, velvety sleep.",
      background: "https://i.pinimg.com/1200x/c6/c0/06/c6c006dd946faaf1fdd1a8be0f96c5d3.jpg",
      choices: [ { text: "Wake up...", next: "butterfly_scene" } ]
    },
    butterfly_scene: {
      text: "You wake up with colorful wings. You are a butterfly! You fly higher and higher until—snap. You're caught in a spider's web.",
      choices: [ { text: "Look at the spider", next: "spider_riddle" } ]
    },
    spider_riddle: {
      text: "'I'll let you go,' the spider hisses, 'if you can answer my riddle. What is the sacred word you carry in your pockets?'",
      input: true,
      buttonText: "Answer Riddle",
      onAction: () => {
        const guess = document.getElementById('player-input').value.toLowerCase();
        if (guess === playerPassword.toLowerCase()) {
          renderScene('spider_success');
        } else {
          renderScene('spider_fail');
        }
      }
    },
    spider_success: {
      text: () => `The spider recoils. '${playerPassword}... so it is.' She cuts the web and lets you fly free into the sunset.`,
      choices: [ { text: "Fly back to the field", next: "pea_field" } ]
    },
    spider_fail: {
      text: "'Inaccurate!' she shrieks. She wraps you tighter. You'll need to try remembering the word again...",
      choices: [ { text: "Try again", next: "spider_riddle" } ]
    }
  };

  function renderScene(sceneKey) {
    const scene = scenes[sceneKey];
    const storyEl = document.getElementById('story-text');
    const choicesEl = document.getElementById('choices');
    const inputArea = document.getElementById('input-area');
    const body = document.getElementById('game-body');

    if (scene.background) {
      body.style.backgroundImage = `url('${scene.background}')`;
    }
    if (scene.action) scene.action();

    storyEl.innerText = (typeof scene.text === "function") ? scene.text() : scene.text;

    choicesEl.innerHTML = "";
    if (scene.input) {
      inputArea.classList.remove('hidden');
      const submitBtn = document.createElement('button');
      submitBtn.className = 'choice-btn';
      submitBtn.innerText = scene.buttonText;
      submitBtn.onclick = scene.onAction;
      choicesEl.appendChild(submitBtn);
      
      document.getElementById('player-input').onkeypress = (e) => {
        if(e.key === 'Enter') scene.onAction();
      };
    } else {
      inputArea.classList.add('hidden');
      document.getElementById('player-input').value = "";
    }

    if (scene.choices) {
      scene.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerText = choice.text;
        btn.onclick = () => renderScene(choice.next);
        choicesEl.appendChild(btn);
      });
    }
  }

  function addToInventory(item) {
    if (!inventory.includes(item)) {
      inventory.push(item);
      document.getElementById('inv-display').innerText = "Inventory: " + inventory.join(", ");
    }
  }

  renderScene('password_check');
</script>

</body>
</html>
