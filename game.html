<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@300&family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background-color: #000;
      background-size: cover; background-position: center;
      font-family: 'Quicksand', sans-serif; color: #fdf5e6;
      display: flex; flex-direction: column; justify-content: flex-end; 
      transition: background 1s ease-in-out; 
    }

    .exit-link {
      position: fixed; top: 20px; left: 20px;
      color: rgba(255, 255, 255, 0.4); font-size: 0.7rem;
      text-decoration: none; font-family: 'Cinzel';
      cursor: pointer; z-index: 100; border: 1px solid rgba(255,255,255,0.2);
      padding: 5px 10px; border-radius: 4px; transition: 0.3s;
    }
    .exit-link:hover { color: #d4af37; border-color: #d4af37; background: rgba(0,0,0,0.5); }

    .game-container {
      width: 100%; background: rgba(0,0,0,0.75); 
      backdrop-filter: blur(12px); border-top: 2px solid #d4af37;
      padding: 30px; box-sizing: border-box; text-align: center;
      min-height: 35%; animation: fadeIn 1s;
    }

    #story-text { 
      font-family: 'Courier Prime', monospace; font-size: 1.2rem; 
      max-width: 900px; margin: 0 auto 20px auto; min-height: 3em;
    }

    #choices {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 15px; max-width: 800px; margin: 0 auto;
    }

    .choice-btn {
      flex: 1; min-width: 200px; background: rgba(212, 175, 55, 0.1);
      border: 1px solid #d4af37; color: #fdf5e6; padding: 12px;
      cursor: pointer; font-family: 'Cinzel'; border-radius: 5px; transition: 0.3s;
    }
    .choice-btn:hover { background: #d4af37; color: #000; box-shadow: 0 0 10px #d4af37; }

    #player-input {
      width: 60%; max-width: 400px; padding: 12px; background: rgba(255,255,255,0.1);
      border: 1px solid #d4af37; color: white; border-radius: 5px;
      margin-bottom: 20px; text-align: center; font-family: 'Courier Prime';
    }

    .inventory { margin-top: 25px; font-size: 0.8rem; color: #d4af37; font-style: italic; opacity: 0.8; letter-spacing: 1px; }
    .hidden { display: none !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body id="game-body">

<a class="exit-link" onclick="location.href='index.html'">[ Return to Sanctuary ]</a>

<div class="game-container">
  <div id="story-text">Loading reality...</div>
  
  <div id="input-area" class="hidden">
    <input type="text" id="player-input" placeholder="Type here..." autocomplete="off">
  </div>

  <div id="choices"></div>
  <div class="inventory" id="inv-display">Inventory: Empty</div>
</div>

<script>
  let playerPassword = "";
  let inventory = [];

  const scenes = {
    password_check: {
      text: "Before the fragment opens, you must choose a password. Choose wisely...",
      input: true,
      buttonText: "Set Password",
      onAction: () => {
        const input = document.getElementById('player-input').value;
        if(input.length < 1) return alert("You need a password!");
        playerPassword = input;
        addToInventory(`Password: ${playerPassword}`); 
        renderScene('password_warning');
      }
    },
    password_warning: {
      text: () => `"${playerPassword}"... interesting choice. You better remember that. There are no password resets in this dimension.`,
      choices: [
        { text: "I understand. Open the gate.", next: "pea_field" }
      ]
    },
    pea_field: {
      text: "As the gate opens a blinding light seeps out. You squint and walk in, and once your eyes adjust, you behold, the citadel of peas. Walking across the outskirts you notice a quiet trellis salespea with a faraway look, and next to his stand a glowing peapod.",
      background: "https://i.pinimg.com/1200x/fd/e8/9b/fde89b5dee8a1005afbe1b65923d27ae.jpg",
      choices: [
        { text: "Talk to the salespearson", next: "giant_pea" },
        { text: "I've always wanted to be a pea in a pod, wonder what it means!", next: "pod_search" }
      ]
    },
    giant_pea: {
      text: "The salespea rotates slowly, ignoring his wares. 'I once loved an Italian plant... Mentha peperita,' it whispers. 'She overwatered herself from crying and died after her favorite book protagonist died without fulfilling the slowburn romance with her rival. Tell me... have you ever been in love?'",
      background: "https://i.pinimg.com/1200x/49/e8/7b/49e87be63ce926806a84c1529c1d5958.jpg",
      choices: [
        { text: "Play Adrianne Lenker's 'Anything'", next: "lenker_path" },
        { text: "Ragebait him with a Kid Yugi song", next: "yugi_path" }
      ]
    },
    lenker_path: {
      text: "The salespea goes silent, mesmerized by the music. He unfurls a coily stemling and points silently toward the field encompassing the citadel. He looks bittersweet as you walk away.",
      background: "https://i.pinimg.com/736x/c4/e9/3f/c4e93f27453842aa774a6c956200a01a.jpg",
      choices: [ { text: "Walk into the field...", next: "pea_field" } ]
    },
    yugi_path: {
      text: "You tell him it's a deep Italian song all chicks love. The beat drops—the salespea turns purple and explodes! A giant chunk hits you in the chest. Everything goes black.",
      choices: [ { text: "Wake up...", next: "lake_party" } ]
    },
    lake_party: {
      text: "You wake up by a shimmering lake. Sea animals are having a massive rave. A dolphin swim-slides over to you with a mischievous grin. 'Yo, new guy! Wanna huff some puffer? It's the good stuff.'",
      background: "https://i.pinimg.com/736x/82/c9/8f/82c98fb149d724563f02e90c3489c238.jpg",
      choices: [ 
        { text: "Huff the puffer", next: "puffer_death" },
        { text: "No thanks, I'm good", next: "sturgeon_meet" }
      ]
    },
    puffer_death: {
      text: "You take a hit. Your vision turns neon pink, your heart stops, and you drop dead instantly. The dolphin high-fives a seal. 'SICK PRANK DUDE!' they yell. Your journey ends here.",
      choices: [ { text: "Restart Reality", next: "password_check" } ]
    },
    sturgeon_meet: {
      text: "The dolphin rolls its eyes. 'Lame!' it shouts, swimming away. You spend the rest of the night talking to a chill 100-year-old sturgeon. She sighs, bubbles escaping her gills. 'Be careful out there, kid. People in this jungle are usually here as punishment for the omnivorous spider. Whatever you do... don't tell her the secret word.'",
      action: () => { addToInventory("Warning: Don't tell Spider"); },
      choices: [ 
        { text: "Stay by the lake and explore in the morning", next: "lake_explore" },
        { text: "Try to get out of this forest asap", next: "forest_escape" }
      ]
    },
    lake_explore: {
      text: "The sun rises over the lake. The sturgeon is gone, but she left a Nippon Biscuit on a lilypad. You feel a strange sense of peace here by the water.",
      action: () => { addToInventory("Nippon Biscuit"); },
      choices: [ { text: "Walk back to the Citadel", next: "pea_field" } ]
    },
    forest_escape: {
      text: "You dash into the dark woods, heart pounding. You don't know where you're going, but you know you can't stay here. The sturgeon's warning echoes in your mind.",
      choices: [ { text: "Run toward the light", next: "pea_field" } ]
    },
    pod_search: {
      text: "You climb into the glowing pod. It’s surprisingly cozy, smelling of sun-warmed grass. You fall into a deep, velvety sleep.",
      background: "https://i.pinimg.com/1200x/c6/c0/06/c6c006dd946faaf1fdd1a8be0f96c5d3.jpg",
      choices: [ { text: "Wake up...", next: "butterfly_scene" } ]
    },
    butterfly_scene: {
      text: "You wake up with colorful wings. You are a butterfly! You fly higher and higher until—snap. You're caught in a spider's web.",
      choices: [ { text: "Look at the spider", next: "spider_riddle" } ]
    },
    spider_riddle: {
      text: "'I'll let you go,' the spider hisses, 'if you can answer my riddle. What is the sacred word you carry in your pockets?'",
      input: true,
      buttonText: "Answer Riddle",
      onAction: () => {
        const guess = document.getElementById('player-input').value.toLowerCase();
        if (guess === playerPassword.toLowerCase()) {
          renderScene('spider_success');
        } else {
          renderScene('spider_fail');
        }
      }
    },
    spider_success: {
      text: () => `The spider recoils as you speak the word '${playerPassword}'. She cuts the web, looking terrified. You fly free into the sunset, shedding your wings as you land back at the Citadel.`,
      choices: [ { text: "Land at the outskirts", next: "pea_field" } ]
    },
    spider_fail: {
      text: "'WRONG!' the spider shrieks. She wraps you in silk. 'If you won't give me the word, you'll give me your nutrients!'",
      choices: [ 
        { text: "Fight to remember", next: "spider_riddle" },
        { text: "Accept your fate", next: "puffer_death" } 
      ]
    }
  };

  function renderScene(sceneKey) {
    const scene = scenes[sceneKey];
    const storyEl = document.getElementById('story-text');
    const choicesEl = document.getElementById('choices');
    const inputArea = document.getElementById('input-area');
    const body = document.getElementById('game-body');

    if (scene.background) {
      body.style.backgroundImage = `url('${scene.background}')`;
    }
    if (scene.action) scene.action();

    storyEl.innerText = (typeof scene.text === "function") ? scene.text() : scene.text;

    choicesEl.innerHTML = "";
    if (scene.input) {
      inputArea.classList.remove('hidden');
      const submitBtn = document.createElement('button');
      submitBtn.className = 'choice-btn';
      submitBtn.innerText = scene.buttonText;
      submitBtn.onclick = scene.onAction;
      choicesEl.appendChild(submitBtn);
      
      document.getElementById('player-input').onkeypress = (e) => {
        if(e.key === 'Enter') scene.onAction();
      };
    } else {
      inputArea.classList.add('hidden');
      document.getElementById('player-input').value = "";
    }

    if (scene.choices) {
      scene.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerText = choice.text;
        btn.onclick = () => renderScene(choice.next);
        choicesEl.appendChild(btn);
      });
    }
  }

  function addToInventory(item) {
    if (!inventory.includes(item)) {
      inventory.push(item);
      document.getElementById('inv-display').innerText = "Inventory: " + inventory.join(", ");
    }
  }

  renderScene('password_check');
</script>
</body>
</html>
