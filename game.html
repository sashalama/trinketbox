<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@300&family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background-color: #000;
      background-size: cover; background-position: center;
      font-family: 'Quicksand', sans-serif; color: #fdf5e6;
      display: flex; flex-direction: column; justify-content: flex-end; 
      transition: background 1s ease-in-out; 
    }

    .exit-link {
      position: fixed; top: 20px; left: 20px;
      color: rgba(255, 255, 255, 0.4); font-size: 0.7rem;
      text-decoration: none; font-family: 'Cinzel';
      cursor: pointer; z-index: 100; border: 1px solid rgba(255,255,255,0.2);
      padding: 5px 10px; border-radius: 4px; transition: 0.3s;
    }
    .exit-link:hover { color: #d4af37; border-color: #d4af37; background: rgba(0,0,0,0.5); }

    .mute-btn {
      position: fixed; top: 20px; right: 20px;
      background: rgba(0, 0, 0, 0.4); border: 1px solid #d4af37;
      color: #d4af37; padding: 10px; cursor: pointer; z-index: 10000;
      border-radius: 50%; width: 40px; height: 40px;
      display: flex; justify-content: center; align-items: center;
    }

    .game-container {
      width: 100%; background: rgba(0,0,0,0.8); 
      backdrop-filter: blur(12px); border-top: 2px solid #d4af37;
      padding: 30px; box-sizing: border-box; text-align: center;
      min-height: 40%; animation: fadeIn 1s;
    }

    #story-text { 
      font-family: 'Courier Prime', monospace; font-size: 1.1rem; 
      max-width: 900px; margin: 0 auto 20px auto; line-height: 1.6;
    }

    #choices {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 15px; max-width: 800px; margin: 0 auto;
    }

    .choice-btn {
      flex: 1; min-width: 250px; background: rgba(212, 175, 55, 0.1);
      border: 1px solid #d4af37; color: #fdf5e6; padding: 12px;
      cursor: pointer; font-family: 'Cinzel'; border-radius: 5px; transition: 0.3s;
    }
    .choice-btn:hover { background: #d4af37; color: #000; box-shadow: 0 0 10px #d4af37; }

    #player-input {
      width: 60%; max-width: 400px; padding: 12px; background: rgba(255,255,255,0.1);
      border: 1px solid #d4af37; color: white; border-radius: 5px;
      margin-bottom: 20px; text-align: center; font-family: 'Courier Prime';
    }

    .hidden { display: none !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body id="game-body">

<button id="mute-btn" class="mute-btn" onclick="toggleMute()">ðŸ”Š</button>
<audio id="myAudio" loop autoplay><source src="fairymusic.mp3" type="audio/mpeg"></audio>

<a class="exit-link" onclick="location.href='index.html'">[ Return to Sanctuary ]</a>

<div class="game-container">
  <div id="story-text">Loading reality...</div>
  
  <div id="input-area" class="hidden">
    <input type="text" id="player-input" placeholder="Type here..." autocomplete="off">
  </div>

  <div id="choices"></div>
</div>

<script>
  let secretWord = "";
  let hasRing = false;

  const scenes = {
    password_check: {
      text: "Before the fragment opens, you must choose a secret word. Choose wisely...",
      input: true,
      buttonText: "Seal the Word",
      onAction: () => {
        const input = document.getElementById('player-input').value;
        if(input.length < 1) return alert("You need a word!");
        secretWord = input;
        renderScene('password_warning');
      }
    },
    password_warning: {
      text: () => `"${secretWord}"... interesting choice. You better remember that. There are no resets in this dimension.`,
      choices: [
        { text: "I understand. Open the gate.", next: "pea_field" }
      ]
    },
    pea_field: {
      text: "As the gate opens a blinding light seeps out. You squint and walk in, and once your eyes adjust, you behold, the citadel of peas. Walking across the outskirts you notice a quiet trellis salespea with a faraway look, and next to his stand a glowing peapod.",
      background: "https://i.pinimg.com/1200x/fd/e8/9b/fde89b5dee8a1005afbe1b65923d27ae.jpg",
      choices: [
        { text: "Talk to the salespearson", next: "giant_pea" },
        { text: "I've always wanted to be a pea in a pod, wonder what it means!", next: "pod_search" }
      ]
    },
    giant_pea: {
      text: "The salespea rotates slowly, ignoring his wares. 'I once loved an Italian plant... Mentha peperita,' it whispers. 'She overwatered herself from crying and died after her favorite book protagonist died. Tell me... have you ever been in love?'",
      background: "https://i.pinimg.com/736x/28/11/b2/2811b250d9d13512a1c1e16157ee1c9f.jpg",
      choices: [
        { text: "Play Adrianne Lenker's 'Anything'", next: "lenker_path" },
        { text: "Ragebait him with a Kid Yugi song", next: "yugi_path" }
      ]
    },
    lenker_path: {
      text: "The salespea goes silent, mesmerized by the music. He unfurls a coily stemling and points silently toward the field encompassing the citadel. You walk for a long time until you meet a figure standing in the tall grass. It is Death.",
      background: "https://i.pinimg.com/736x/c4/e9/3f/c4e93f27453842aa774a6c956200a01a.jpg",
      choices: [
        { text: "Ask him about a loved one who passed away", next: "death_loved_one" },
        { text: "Ask him about the meaning of life", next: "death_life" }
      ]
    },
    death_loved_one: {
      text: "Death looks at the horizon. 'They went where they wanted to go,' he says simply. He seems to wait for your next thought.",
      choices: [
        { text: "Ask about life instead", next: "death_life" },
        { text: "Say goodbye", next: "death_end" }
      ]
    },
    death_life: {
      text: "Death chuckles softly. 'Save yourself the painful explanation and go watch Adventure Time. They do it well. I liked how they imagined me.'",
      choices: [
        { text: "Ask about your loved one instead", next: "death_loved_one" },
        { text: "Say goodbye", next: "death_end" }
      ]
    },
    death_end: {
      text: "'Well, you seem like a decent fellow,' Death says as the sun begins to set. 'Walk straight for a while, you should find the Goddess of the End.' With that, he disappears into the twilight.",
      choices: [ { text: "Walk into the darkness...", next: "goddess_end_sprout" } ]
    },
    goddess_end_sprout: {
      text: "You walk until the sun sets completely. You reach a large sproutling as big as a tree. You drink the dewdrop from its leaf and see a reflection... there is a treehouse above! You climb up and knock. The door is already ajar.",
      choices: [ { text: "Walk inside", next: "hamster_scene" } ]
    },
    hamster_scene: {
      text: "You walk in and a giant hamster the size of the house itself takes up every ounce of room. It lurches at you, whiskers twitching violently!",
      choices: [
        { text: "Pretend to be a baby hamster", next: "hamster_death" },
        { text: "Tell her your secret word", next: "goddess_end_reveal" }
      ]
    },
    hamster_death: {
      text: "The hamster looks at you with a primal instinct. Before you can squeak, she swallows you whole.",
      action: () => { setTimeout(() => { window.location.href = "https://www.reddit.com/r/biology/comments/4cwicq/why_did_my_hamster_eat_her_babies/?rdt=44346"; }, 2500); }
    },
    goddess_end_reveal: {
      text: () => `As you speak "${secretWord}", the creature shimmers and turns into a beautiful ladyâ€”the Goddess of the End! She hugs you. 'Only the one who speaks the secret word could save me!' But she looks sad. She explains she missed her hundred-yearly appointment with her lover because she got nervous and turned into a hamster.`,
      choices: [
        { text: "Give her the ring and tell her what happened", next: "ring_ending", condition: () => hasRing },
        { text: "Comfort her", next: "kiss_ending" }
      ],
      renderHook: (scene) => {
        if (!hasRing) scene.choices = scene.choices.filter(c => c.text !== "Give her the ring and tell her what happened");
      }
    },
    ring_ending: {
      text: "You hand her the diamond ring you found in the kelp forest. Her eyes light up with joy. 'You found it! My lover's ring!' She kisses your forehead and sends you home.",
      action: () => { setTimeout(() => { window.location.href = "index.html"; }, 3000); }
    },
    kiss_ending: {
      text: "You comfort her as best you can. She smiles sadly, kisses your forehead, and you feel yourself drifting back to your sanctuary.",
      action: () => { setTimeout(() => { window.location.href = "index.html"; }, 3000); }
    },

    // --- CAT PATH ---
    spider_spare: {
      text: "'Very well. Keep your secrets,' the spider hisses. She lets you tumble back toward the ground. Tired, you fall asleep under a massive mushroom. When you awaken, you are human again. A wet Bengal cat is shaking water onto you.",
      choices: [ { text: "Ask the cat where to go", next: "cat_convo" } ]
    },
    cat_convo: {
      text: "'Where do you want to be?' the cat asks. You say you don't know. 'Well then it doesn't matter, does it?' it responds. You plead for it to take you somewhere. 'Who do you take me for, the Cheshire Cat?' it guaffs. It sees your tears and rolls its eyes. 'What is four times five?'",
      input: true,
      buttonText: "Answer the Cat",
      onAction: () => {
        const ans = document.getElementById('player-input').value;
        if (ans == "12") renderScene('cat_success');
        else renderScene('cat_starve');
      }
    },
    cat_starve: {
      text: "The cat looks at you with pity. 'Math is the language of the universe, and you are silent.' It leaves you. You wander until you starve, lost in the woods.",
      action: () => { setTimeout(() => { window.location.href = "https://www.magellantv.com/articles/alice-in-wonderlands-hidden-satire-math-slips-down-the-rabbit-hole"; }, 2500); }
    },
    cat_success: {
      text: "The cat purrs. 'Precisely.' It leads you to a cottage deep in the forest. 'This is where the Goddess of the Beginning lives. Speak with reverence.' Inside, a lady who looks like a witch is crying. She lost her lover's ring to a fish at a kelp forest and missed their anniversary.",
      choices: [
        { text: "Ask her who her girlfriend is", next: "witch_zap" },
        { text: "Reassure her she'll get a letter back soon", next: "witch_box" }
      ]
    },
    witch_zap: {
      text: "Goddess B looks at you with fury. 'Some things are sacred!' She zaps you instantly.",
      action: () => { setTimeout(() => { window.location.href = "https://www.nhm.ac.uk/resources/visit/wpy/2024/small/webp/2ade44e5-aaea-4306-b4a8-febf0b71d824.webp"; }, 2500); }
    },
    witch_box: {
      text: "She stops crying. 'You're right... there must be a technical problem.' She blesses you with a box. You open it and find yourself home.",
      action: () => { setTimeout(() => { window.location.href = "index.html"; }, 3000); }
    },

    // --- WHALE PRINCE PATH ---
    sturgeon_meet: {
      text: "You stay by the estuary. In the morning, a puppy-sized nudibranch starts cuddling you.",
      background: "https://i.pinimg.com/736x/82/c9/8f/82c98fb149d724563f02e90c3489c238.jpg",
      choices: [
        { text: "Pet it", next: "pet_nudibranch" },
        { text: "Scream and push it away", next: "nudibranch_death" }
      ]
    },
    nudibranch_death: {
      text: "You push it away and fall backward... right onto a Portuguese Man o' War. The sting is fatal.",
      action: () => { setTimeout(() => { window.location.href = "https://youtu.be/aIovmgzyuL0?si=1S7plgHHDUy4skZ_"; }, 2500); }
    },
    pet_nudibranch: {
      text: "You pet it. A giant merman, Prince Zeth, emerges from the water. He hands you a sea flower to breathe and seaweed for your ears. 'My nudibranch wants me to take you to the kelp forest.'",
      choices: [ { text: "Follow him into the depths", next: "kelp_forest" } ]
    },
    kelp_forest: {
      text: "In the kelp forest, you find a fish skeleton. Inside is a glimmering diamond ring!",
      choices: [
        { text: "Offer it to the nudibranch", next: "give_ring" },
        { text: "Slip it on your finger", next: "ring_death" }
      ]
    },
    ring_death: {
      text: "As the ring touches your skin, the water turns cold. 'Only SHE wears the ring,' a voice booms. You fade away.",
      choices: [ { text: "Restart", next: "password_check" } ]
    },
    give_ring: {
      text: "Prince Zeth smiles. 'Hold on to it, but do not wear it.' With a powerful whale song, he sends you back to the surface.",
      action: () => { hasRing = true; setTimeout(() => { window.location.href = "index.html"; }, 3000); }
    },
    forest_escape: {
      text: "You dash into the woods and trip over a baby muntjac. Its rhino friend is not happy.",
      action: () => { setTimeout(() => { window.location.href = "https://youtu.be/jNNm8fTzxOw?si=w1UnCT96pEmCyqzs"; }, 2500); }
    },

    // ... (rest of the spider logic from previous version) ...
    spider_riddle: {
      text: "A beautiful spider waltzes her way up. 'Tell me the secret word and I might let you live,' she says in a thick Greek accent.",
      background: "https://i.pinimg.com/1200x/c8/1b/95/c81b95660d2174852100813f70cfa29a.jpg",
      choices: [
        { text: "Give her your word", next: "spider_betrayal" },
        { text: "Refuse", next: "spider_refuse" },
        { text: "Did you build this whole web yourself?", next: "spider_convo" }
      ]
    },
    spider_betrayal: {
      text: "'Ah, delicious honesty,' she purrs. She bites. The word was the dinner bell.",
      action: () => { setTimeout(() => { window.location.href = "https://www.euronews.com/green/2025/11/07/worlds-biggest-spiderweb-home-to-more-than-110000-spiders-discovered-on-the-albanian-greek"; }, 2500); }
    },
    spider_refuse: {
      text: () => `She sighs and whispers: "${secretWord}." She knew it. You are wrapped in silk and eaten.`,
      action: () => { setTimeout(() => { window.location.href = "https://www.euronews.com/green/2025/11/07/worlds-biggest-spiderweb-home-to-more-than-110000-spiders-discovered-on-the-albanian-greek"; }, 2500); }
    },
    spider_convo: {
      text: "She tells you of her Greco-Albanian family and how they left her. She looks lonely.",
      choices: [
        { text: "Comfort her", next: "spider_comfort" },
        { text: "Ask how to leave", next: "spider_betrayal" }
      ]
    },
    spider_comfort: {
      text: "She lets you fall safely to the ground.",
      choices: [ { text: "Wake up under a mushroom", next: "spider_spare" } ]
    },
    yugi_path: {
      text: "The salespea explodes! Everything goes black.",
      choices: [ { text: "Wake up by a lake", next: "lake_party" } ]
    },
    puffer_death: {
      text: "SICK PRANK DUDE!",
      action: () => { setTimeout(() => { window.location.href = "https://youtu.be/msx3BAhIeQg?si=iADRvnoUdN5XTowY"; }, 2500); }
    }
  };

  function renderScene(sceneKey) {
    const scene = scenes[sceneKey];
    const storyEl = document.getElementById('story-text');
    const choicesEl = document.getElementById('choices');
    const inputArea = document.getElementById('input-area');
    const body = document.getElementById('game-body');

    if (scene.background) body.style.backgroundImage = `url('${scene.background}')`;
    if (scene.renderHook) scene.renderHook(scene);
    if (scene.action) scene.action();

    storyEl.innerText = (typeof scene.text === "function") ? scene.text() : scene.text;

    choicesEl.innerHTML = "";
    if (scene.input) {
      inputArea.classList.remove('hidden');
      const submitBtn = document.createElement('button');
      submitBtn.className = 'choice-btn';
      submitBtn.innerText = scene.buttonText;
      submitBtn.onclick = scene.onAction;
      choicesEl.appendChild(submitBtn);
    } else {
      inputArea.classList.add('hidden');
      document.getElementById('player-input').value = "";
    }

    if (scene.choices) {
      scene.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerText = choice.text;
        btn.onclick = () => renderScene(choice.next);
        choicesEl.appendChild(btn);
      });
    }
  }

  function toggleMute() {
    const audio = document.getElementById('myAudio');
    const btn = document.getElementById('mute-btn');
    if (audio.paused) { audio.play(); btn.innerText = "ðŸ”Š"; }
    else { audio.pause(); btn.innerText = "ðŸ”ˆ"; }
  }

  renderScene('password_check');
</script>
</body>
</html>
