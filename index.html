<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@300&family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: url('https://i.pinimg.com/736x/ba/d4/14/bad4142a111da56f80b414eb2b0a9eb8.jpg') no-repeat center center fixed;
      background-size: cover; overflow: hidden; font-family: 'Quicksand', sans-serif;
      color: #fdf5e6;
    }

    /* Initially hide the landing page */
    #landing-page { display: none; }

    /* Password input focus glow */
    #pass-input:focus { outline: none; box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); }

    /* Sparkle Styles */
    .sparkle {
      position: absolute; width: 6px; height: 6px; background: gold;
      border-radius: 50%; pointer-events: none; box-shadow: 0 0 10px gold;
      animation: sparkle-fade 1s linear forwards; z-index: 9999;
    }
    @keyframes sparkle-fade { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

    /* Wooden Sign Styles */
    .wooden-sign {
      background: #4a2c1a;
      background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
      border: 10px solid #3d2414;
      border-radius: 5px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
      position: relative;
      max-width: 80%;
    }
    .wooden-sign::before, .wooden-sign::after {
      content: '•'; position: absolute; color: #222; font-size: 20px; top: 5px;
    }
    .wooden-sign::before { left: 10px; }
    .wooden-sign::after { right: 10px; }

    /* Animations */
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .entrance-button {
      position: absolute; width: 120px; height: 120px;
      background-size: contain; background-repeat: no-repeat;
      background-color: transparent; border: none; cursor: pointer;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.4));
      animation: float 4s ease-in-out infinite; transition: transform 0.3s;
    }
    .entrance-button:hover { transform: scale(1.2) !important; filter: brightness(1.2); }

    .shell-diary { background-image: url('https://i.pinimg.com/736x/5f/27/3c/5f273c72f5d8420be067d93ef87ccbda.jpg'); top: 20%; left: 15%; }
    .shell-color { background-image: url('https://i.pinimg.com/736x/27/0e/68/270e6837697de77f0b061e05135b3e69.jpg'); top: 60%; left: 25%; animation-delay: 1s; }
    .shell-game  { background-image: url('https://i.pinimg.com/736x/3a/a7/4a/3aa74ac23f646d71302206e3bd70286d.jpg'); top: 40%; left: 70%; animation-delay: 2s; }
    .shell-gallery { background-image: url('https://i.pinimg.com/736x/9f/1c/ee/9f1cee474d94aba8ef5bdabc1a3f41bd.jpg'); top: 75%; left: 60%; animation-delay: 2.5s; }

    .overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(15px);
      flex-direction: column; justify-content: center; align-items: center;
      z-index: 10; animation: fadeIn 0.8s;
    }

    #diary-input, #img-url-input, #nickname-input {
      width: 60%; max-width: 500px; background: rgba(255,255,255,0.1);
      border: 1px solid #d4af37; color: #fdf5e6; padding: 15px;
      font-family: 'Courier Prime', monospace; border-radius: 8px; margin-bottom: 10px;
    }
    #nickname-input { width: 30%; max-width: 200px; }

    #diary-wall, #gallery-wall {
      width: 70%; max-height: 350px; overflow-y: auto;
      margin-top: 20px; display: flex; flex-direction: column; gap: 15px;
    }

    .diary-entry, .photo-card {
      background: rgba(253, 245, 230, 0.05); border-left: 3px solid #d4af37;
      padding: 15px; font-family: 'Courier Prime'; font-size: 0.9rem; white-space: pre-wrap;
      position: relative;
    }

    .photo-card { border: none; padding: 0; display: inline-block; }
    .photo-card img { width: 180px; border: 1px solid #d4af37; border-radius: 5px; transition: 0.3s; }

    .entry-header { color: #d4af37; font-size: 0.75rem; font-weight: bold; margin-bottom: 5px; display: block; }

    .delete-btn {
      position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.4); border: none;
      color: #ff4d4d; cursor: pointer; font-family: 'Courier Prime'; font-weight: bold;
      opacity: 0.5; transition: opacity 0.3s; border-radius: 3px; z-index: 5;
    }
    .delete-btn:hover { opacity: 1; }

    #gallery-wall { flex-direction: row; flex-wrap: wrap; justify-content: center; gap: 20px; }

    .back-btn {
      margin-top: 20px; background: none; border: 1px solid #fdf5e6;
      color: white; padding: 10px 20px; cursor: pointer; font-family: 'Cinzel';
    }
    .back-btn:hover { background: #d4af37; color: #000; }

    .show { display: flex !important; }
    .hide { display: none !important; }
  </style>
</head>
<body>

<audio id="myAudio" loop><source src="fairymusic.mp3" type="audio/mpeg"></audio>

<div id="lock-screen" class="overlay" style="display: flex; background: rgba(0,0,0,0.95); z-index: 100;">
  <h1 style="font-family: 'Cinzel'; color: #d4af37;">Locked Sanctuary</h1>
  <p style="font-family: 'Quicksand'; font-style: italic;">Enter the secret word to open the box...</p>
  <input type="password" id="pass-input" placeholder="Secret Word" style="padding: 15px; border-radius: 5px; border: 1px solid #d4af37; background: none; color: white; text-align: center;">
  <button class="back-btn" onclick="checkPass()">Unlock</button>
</div>
  
<div id="landing-page">
  <button class="entrance-button shell-diary" onclick="openSection('diary-page')"></button>
  <button class="entrance-button shell-color" onclick="openSection('color-page'); generateColor();"></button>
  <button class="entrance-button shell-game" onclick="openSection('game-page')"></button>
  <button class="entrance-button shell-gallery" onclick="openSection('gallery-overlay')"></button>
</div>

<div id="diary-page" class="overlay">
  <h1 style="font-family: 'Cinzel'">The Shared Altar</h1>
  <input type="text" id="nickname-input" placeholder="Your Name">
  <textarea id="diary-input" placeholder="Type a thought..."></textarea>
  <button class="back-btn" onclick="saveEntry()" style="margin-top: 5px;">Pin to Wall</button>
  <div id="diary-wall"></div>
  <button class="back-btn" onclick="closeAll()">Go Back</button>
</div>

<div id="gallery-overlay" class="overlay">
  <h1 style="font-family: 'Cinzel'">Memory Gallery</h1>
  <div style="margin-bottom: 20px; text-align: center;">
    <input type="text" id="img-url-input" placeholder="Paste Pinterest Image Link...">
    <button class="back-btn" onclick="addLinkToGallery()" style="margin-top: 5px;">Pin Image</button>
  </div>
  <div id="gallery-wall"></div>
  <button class="back-btn" onclick="closeAll()">Go Back</button>
</div>

<div id="color-page" class="overlay">
  <h1 style="font-family: 'Cinzel'">Color of the Day</h1>
  <div id="color-display" style="width:150px; height:150px; border-radius:50%; border:4px solid white; margin-bottom:20px; transition: 0.5s;"></div>
  <h2 id="color-name" style="font-family: 'Courier Prime'">---</h2>
  <button class="back-btn" onclick="closeAll()">Go Back</button>
</div>

<div id="game-page" class="overlay">
  <div class="wooden-sign">
    <h1 style="font-family: 'Cinzel'; color: #d4af37; margin: 0;">Under Construction</h1>
    <p style="font-family: 'Courier Prime'; color: #fdf5e6; margin-top: 15px;">
      The fragments are currently being gathered...<br>Please return when the stars align.
    </p>
    <button class="back-btn" onclick="closeAll()" style="border-color: #d4af37; color: #d4af37;">Close</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // PASSCODE LOGIC
  function checkPass() {
    const pass = document.getElementById('pass-input').value.toLowerCase();
    const secretWord = "hitthegritty";
    if (pass === secretWord) {
      document.getElementById('lock-screen').style.display = 'none';
      document.getElementById('landing-page').style.display = 'block';
      document.getElementById('myAudio').play();
    } else {
      alert("The box remains closed. Try again...");
      document.getElementById('pass-input').value = "";
    }
  }

  document.getElementById("pass-input").addEventListener("keyup", (event) => {
    if (event.key === "Enter") checkPass();
  });

  // FIREBASE INIT
  const firebaseConfig = {
    apiKey: "AIzaSyAzuYcCkc9p0JZ7yG9_YBmjVDpRD5FPQuE",
    authDomain: "trinketbox-e3226.firebaseapp.com",
    databaseURL: "https://trinketbox-e3226-default-rtdb.europe-west1.firebasedatabase.app/",
    projectId: "trinketbox-e3226",
    storageBucket: "trinketbox-e3226.firebasestorage.app",
    messagingSenderId: "708656172623",
    appId: "1:708656172623:web:f5bffcce64a2bc99bf643a",
    measurementId: "G-08JRE2SV4W"
  };

  if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
  }
  const database = firebase.database();

  // DIARY LOGIC
  function saveEntry() {
    const nick = document.getElementById('nickname-input').value || "Anonymous";
    const text = document.getElementById('diary-input').value.trim();
    if (!text) return;
    database.ref('messages').push().set({ name: nick, text: text, date: new Date().toLocaleString() })
    .then(() => console.log("Saved!"))
    .catch((e) => alert("Error: " + e.message));
    document.getElementById('diary-input').value = ""; 
  }

  database.ref('messages').on('value', (snapshot) => {
    const wall = document.getElementById('diary-wall');
    wall.innerHTML = `<div class="diary-entry"><span class="entry-header">SYSTEM</span>Welcome to the Trinket Box.</div>`;
    const data = snapshot.val();
    if (data) {
      Object.entries(data).reverse().forEach(([key, entry]) => {
        const div = document.createElement('div');
        div.className = 'diary-entry';
        div.innerHTML = `<button class="delete-btn" onclick="deleteEntry('${key}')">×</button><span class="entry-header">${entry.name} — ${entry.date}</span>${entry.text}`;
        wall.appendChild(div);
      });
    }
  });

  function deleteEntry(postId) {
    if(confirm("Discard this memory forever?")) database.ref('messages').child(postId).remove();
  }

  // GALLERY LOGIC
  function addLinkToGallery() {
    const url = document.getElementById('img-url-input').value.trim();
    if(!url) return;
    database.ref('gallery').push().set({ url: url })
    .then(() => console.log("Image Added!"))
    .catch((e) => alert("Error: " + e.message));
    document.getElementById('img-url-input').value = "";
  }

  database.ref('gallery').on('value', (snapshot) => {
    const wall = document.getElementById('gallery-wall');
    wall.innerHTML = "";
    const data = snapshot.val();
    if (data) {
      Object.entries(data).reverse().forEach(([key, item]) => {
        const div = document.createElement('div');
        div.className = 'photo-card';
        div.innerHTML = `<button class="delete-btn" onclick="deletePhoto('${key}')">×</button><img src="${item.url}">`;
        wall.appendChild(div);
      });
    } else {
        wall.innerHTML = "<p style='font-family:Courier Prime; opacity:0.5;'>The gallery is empty. Pin a memory...</p>";
    }
  });

  function deletePhoto(photoId) {
    if(confirm("Remove this image from the gallery?")) {
        database.ref('gallery').child(photoId).remove();
    }
  }

  // COLOR GENERATOR
  function generateColor() {
    const colors = [
      { name: "RUBY", hex: "#9b111e" },
      { name: "SAPPHIRE", hex: "#0f52ba" },
      { name: "EMERALD", hex: "#50c878" },
      { name: "AMETHYST", hex: "#9966cc" },
      { name: "ROSE QUARTZ", hex: "#f7cac9" },
      { name: "CELESTIAL BLUE", hex: "#4997d0" },
      { name: "FOREST MIST", hex: "#2d5a27" },
      { name: "GOLDEN HOUR", hex: "#ff8c00" },
      { name: "MOONLIGHT", hex: "#778899" },
      { name: "LAVENDER DUSK", hex: "#856088" },
      { name: "OBSIDIAN", hex: "#1a1a1b" },
      { name: "PEARL", hex: "#f0ead6" }
    ];
    
    const r = colors[Math.floor(Math.random() * colors.length)];
    const display = document.getElementById('color-display');
    const nameLabel = document.getElementById('color-name');
    
    display.style.backgroundColor = r.hex;
    display.style.boxShadow = `0 0 30px ${r.hex}`; 
    nameLabel.innerText = r.name;
  }

  // NAVIGATION & SPARKLES
  function openSection(id) {
    document.getElementById('myAudio').play();
    document.getElementById(id).classList.add('show');
    document.getElementById('landing-page').classList.add('hide');
  }
  function closeAll() {
    document.querySelectorAll('.overlay').forEach(el => el.classList.remove('show'));
    document.getElementById('landing-page').classList.remove('hide');
  }

  document.addEventListener('mousemove', (e) => {
    const sparkle = document.createElement('div');
    sparkle.className = 'sparkle';
    sparkle.style.left = e.pageX + 'px'; sparkle.style.top = e.pageY + 'px';
    const size = Math.random() * 8 + 2;
    sparkle.style.width = size + 'px'; sparkle.style.height = size + 'px';
    document.body.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 1000);
  });
</script>
</body>
</html>
